<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#ff3b7b" />
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <title>üíò A Question For You</title>
  <style>
    :root{
      --bg1:#ffeff6;
      --bg2:#fff7e8;
      --card:#ffffffcc;
      --text:#1f1f1f;
      --yes:#ff3b7b;
      --shadow: 0 18px 55px rgba(0,0,0,.14);
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh;
      display:flex; align-items:center; justify-content:center;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 15% 15%, var(--bg1), transparent 60%),
        radial-gradient(1200px 800px at 85% 85%, var(--bg2), transparent 60%),
        linear-gradient(140deg, #ffe1ee, #fff3d9);
      overflow:hidden;
    }
    .hearts{
      position:fixed; inset:0; pointer-events:none; opacity:.75;
      background-image:
        radial-gradient(circle at 10% 30%, rgba(255,59,123,.22) 0 6px, transparent 7px),
        radial-gradient(circle at 40% 80%, rgba(255,59,123,.18) 0 5px, transparent 6px),
        radial-gradient(circle at 70% 25%, rgba(255,59,123,.15) 0 7px, transparent 8px),
        radial-gradient(circle at 88% 60%, rgba(255,59,123,.12) 0 4px, transparent 5px);
      animation: floaty 8s ease-in-out infinite alternate;
    }
    @keyframes floaty{ from{transform:translateY(-6px)} to{transform:translateY(10px)} }

    .card{
      width:min(860px, 94vw);
      padding:22px 22px 16px;
      border-radius:28px;
      background:var(--card);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      border:1px solid rgba(255,255,255,.65);
      position:relative;
    }
    .toprow{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      flex-wrap:wrap;
    }
    .badge{
      display:inline-flex; gap:10px; align-items:center;
      padding:10px 14px; border-radius:999px;
      background: rgba(255,255,255,.8);
      border:1px solid rgba(0,0,0,.06);
      font-weight:800; letter-spacing:.2px;
    }
    .badge .dot{
      width:10px; height:10px; border-radius:999px;
      background: linear-gradient(135deg, #ff3b7b, #ff8aa8);
      box-shadow: 0 0 0 6px rgba(255,59,123,.12);
    }

    .audioPill{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 12px; border-radius:999px;
      border:1px solid rgba(0,0,0,.07);
      background: rgba(255,255,255,.78);
      font-weight:900;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .audioPill small{opacity:.65; font-weight:800}
    .audioPill .icon{font-size:16px}
    .audioPill.off{opacity:.78}
    .audioPill:active{transform:scale(.99)}

    h1{ margin:14px 0 6px; font-size: clamp(28px, 4.6vw, 46px); line-height:1.05; }
    .sub{ margin:0 0 14px; font-size: clamp(14px, 2.4vw, 18px); opacity:.82; }

    .grid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:14px;
    }
    @media (max-width: 780px){
      .grid{ grid-template-columns: 1fr; }
    }

    .stage{
      position:relative;
      height:270px;
      border-radius:22px;
      border:1px dashed rgba(0,0,0,.10);
      background: rgba(255,255,255,.55);
      overflow:hidden;
    }
    .bubble{
      position:absolute; left:16px; top:16px;
      max-width: 86%;
      padding:12px 14px;
      border-radius:18px;
      background:#fff;
      border:1px solid rgba(0,0,0,.07);
      box-shadow: 0 12px 25px rgba(0,0,0,.08);
      font-size: 15px;
      line-height:1.35;
      z-index:2;
    }
    .bubble b{color:#ff2f75}
    .buttons{ position:absolute; left:0; top:0; right:0; bottom:0; }

    button{
      position:absolute;
      border:0; cursor:pointer; border-radius:16px;
      font-weight:900; letter-spacing:.3px;
      transition: transform .15s ease, filter .15s ease, left .12s ease, top .12s ease;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    button:active{ transform: scale(.98); }
    .yes{
      background: linear-gradient(135deg, var(--yes), #ff86ad);
      color:#fff;
      box-shadow: 0 16px 30px rgba(255,59,123,.28);
      padding:16px 22px;
      font-size: 18px;
      z-index:1;
    }
    .no{
      background: rgba(0,0,0,.86);
      color:#fff;
      padding:14px 18px;
      font-size: 15px;
      box-shadow: 0 12px 26px rgba(0,0,0,.18);
      z-index:1;
    }

    .panel{
      border-radius:22px;
      background: rgba(255,255,255,.62);
      border:1px solid rgba(0,0,0,.07);
      overflow:hidden;
      min-height:270px;
      display:flex;
      flex-direction:column;
    }
    .panelHeader{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:12px 12px 10px;
      border-bottom:1px solid rgba(0,0,0,.07);
      background: rgba(255,255,255,.7);
    }
    .panelHeader .title{
      font-weight:900;
      letter-spacing:.2px;
    }
    .panelHeader .meta{
      font-size:12px; opacity:.7; font-weight:800;
    }

    /* ‚Äúno-photos‚Äù slideshow cards */
    .memoryWrap{
      flex:1;
      padding:12px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: linear-gradient(135deg, rgba(255,255,255,.9), rgba(255,245,250,.9));
      position:relative;
      overflow:hidden;
    }
    .memoryCard{
      width:100%;
      border-radius:20px;
      border:1px solid rgba(0,0,0,.07);
      background:#fff;
      box-shadow: 0 14px 30px rgba(0,0,0,.08);
      padding:16px 14px;
      position:absolute;
      opacity:0;
      transform: translateY(10px) scale(.98);
      transition: opacity .5s ease, transform .8s ease;
    }
    .memoryCard.show{
      opacity:1;
      transform: translateY(0) scale(1);
    }
    .memoryTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:7px 10px;
      border-radius:999px;
      background: rgba(255,59,123,.10);
      border:1px solid rgba(255,59,123,.20);
      font-weight:900;
      font-size:12px;
    }
    .emojiBig{
      font-size:44px;
      filter: drop-shadow(0 10px 14px rgba(0,0,0,.10));
    }
    .memoryText{
      font-size:14px;
      opacity:.88;
      line-height:1.45;
      font-weight:700;
    }
    .memoryFooter{
      margin-top:12px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      font-size:12px;
      opacity:.7;
      font-weight:800;
    }

    .hint{
      display:flex; justify-content:space-between; gap:10px;
      margin-top:12px; font-size:13px; opacity:.75;
    }
    .tiny{
      font-size:12px;
      opacity:.7;
      margin-top:8px;
      line-height:1.4;
    }
    .footer{
      display:flex; justify-content:space-between; align-items:center;
      margin-top:12px; gap:10px;
      font-size:12px; opacity:.7;
    }
    .link{
      text-decoration:none;
      color:#ff2f75;
      font-weight:900;
      cursor:pointer;
    }

    /* confetti */
    .confetti{ position:fixed; inset:0; pointer-events:none; overflow:hidden; }
    .piece{
      position:absolute; width:10px; height:14px; border-radius:3px; opacity:.95;
      animation: fall 1.8s linear forwards;
    }
    @keyframes fall{
      0%{ transform: translateY(-20px) rotate(0deg); }
      100%{ transform: translateY(110vh) rotate(600deg); }
    }

    /* final overlay */
    .overlay{
      position:fixed; inset:0;
      display:none; align-items:center; justify-content:center;
      padding:20px;
      background: rgba(10,10,10,.35);
      backdrop-filter: blur(6px);
      z-index:50;
    }
    .modal{
      width:min(760px, 94vw);
      border-radius:28px;
      background:#fff;
      box-shadow: var(--shadow);
      padding:18px 18px 16px;
      border: 1px solid rgba(0,0,0,.06);
      position:relative;
      overflow:hidden;
    }
    .modalTop{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-bottom:8px;
    }
    .close{
      border:1px solid rgba(0,0,0,.10);
      background:#f3f3f6;
      border-radius:12px;
      padding:8px 10px;
      font-weight:900;
      cursor:pointer;
      position:static;
    }
    .modal h2{ margin:6px 0 6px; font-size: clamp(26px, 4vw, 38px); text-align:center; }
    .modal p{
      margin:0 auto 14px;
      max-width: 60ch;
      opacity:.88;
      line-height:1.45;
      text-align:center;
      font-weight:700;
    }
    .modal .row{
      display:flex;
      justify-content:center;
      margin-top:10px;
    }
    .modal .row button{
      position:static;
      padding:14px 18px;
      border-radius:16px;
      font-size:16px;
    }

    /* ring reveal */
    .ringStage{
      height:180px;
      border-radius:22px;
      background: radial-gradient(circle at 35% 30%, rgba(255,59,123,.18), transparent 55%),
                  radial-gradient(circle at 70% 70%, rgba(255,200,90,.22), transparent 55%),
                  linear-gradient(135deg, #fff, #fff7fb);
      border:1px solid rgba(0,0,0,.06);
      display:flex;
      align-items:center;
      justify-content:center;
      margin:12px 0 10px;
      position:relative;
      overflow:hidden;
    }
    .ring{
      width:84px; height:84px;
      border-radius:999px;
      border:10px solid #f2c14e;
      box-shadow: 0 18px 40px rgba(0,0,0,.12);
      position:relative;
      transform: translateY(40px) scale(.6);
      opacity:0;
    }
    .ring:after{
      content:"";
      position:absolute;
      width:22px; height:22px;
      background: #8ad7ff;
      border-radius:6px;
      top:-18px; left:50%;
      transform: translateX(-50%) rotate(45deg);
      box-shadow: 0 10px 18px rgba(0,0,0,.10);
      border: 2px solid rgba(255,255,255,.7);
    }
    .ringGlow{
      position:absolute;
      width:240px; height:240px;
      border-radius:999px;
      background: radial-gradient(circle, rgba(255,59,123,.22), transparent 62%);
      opacity:0;
      transform: scale(.9);
    }
    .ring.show{ opacity:1; animation: ringPop .9s cubic-bezier(.2,.9,.2,1) forwards; }
    .ringGlow.show{ opacity:1; animation: glow 1.3s ease-out forwards; }
    @keyframes ringPop{
      0%{ transform: translateY(40px) scale(.6) rotate(-8deg); }
      60%{ transform: translateY(-4px) scale(1.05) rotate(6deg); }
      100%{ transform: translateY(0px) scale(1) rotate(0deg); }
    }
    @keyframes glow{
      0%{ transform: scale(.85); opacity:.0; }
      40%{ transform: scale(1.05); opacity:.9; }
      100%{ transform: scale(1.15); opacity:.0; }
    }

    .toast{
      position:fixed;
      left:50%;
      bottom:20px;
      transform:translateX(-50%);
      background: rgba(0,0,0,.82);
      color:#fff;
      padding:10px 12px;
      border-radius:14px;
      font-size:13px;
      font-weight:900;
      opacity:0;
      pointer-events:none;
      transition: opacity .2s ease, transform .2s ease;
      z-index:80;
    }
    .toast.show{
      opacity:1;
      transform:translateX(-50%) translateY(-4px);
    }
  </style>
</head>

<body>
  <div class="hearts"></div>

  <div class="card">
    <div class="toprow">
      <div class="badge"><span class="dot"></span><span id="badgeText">Valentine Mode: ON</span></div>

      <div class="audioPill off" id="audioPill" title="Tap to play music">
        <span class="icon" id="audioIcon">üîá</span>
        <span id="audioLabel">Music</span>
        <small id="audioSmall">(tap)</small>
      </div>
    </div>

    <h1 id="title">Hey love‚Ä¶ I have a tiny question üíå</h1>
    <p class="sub" id="subtitle">No speeches. Just vibes. And one button that refuses to be clicked.</p>

    <div class="grid">
      <!-- LEFT -->
      <div>
        <div class="stage" id="stage">
          <div class="bubble">
            <span id="bubbleText">
              Will you be my Valentine? <br/>
              <small>(The <b>NO</b> button is‚Ä¶ doing cardio.)</small>
            </span>
          </div>

          <div class="buttons">
            <button class="yes" id="yesBtn">YES üíñ</button>
            <button class="no" id="noBtn">No üôà</button>
          </div>
        </div>

        <div class="hint">
          <span id="counter">No attempts: 0</span>
          <span id="mood">Mood: ü•∫</span>
        </div>

        <div class="tiny">Tip: the YES button never runs. It‚Äôs loyal.</div>

        <div class="footer">
          <span>Made with love + a tiny bit of chaos.</span>
          <a class="link" href="#" id="resetLink">Reset</a>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="panel">
        <div class="panelHeader">
          <div class="title">Tiny love moments ‚ú®</div>
          <div class="meta" id="slideMeta">1 / 6</div>
        </div>

        <div class="memoryWrap" id="memoryWrap">
          <div class="memoryCard" id="mA"></div>
          <div class="memoryCard" id="mB"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="confetti" id="confetti"></div>

  <div class="overlay" id="overlay">
    <div class="modal">
      <div class="modalTop">
        <div style="font-size:18px;font-weight:900;">üíò</div>
        <button class="close" id="closeOverlay" aria-label="Close">‚úï</button>
      </div>

      <h2 id="finalTitle">One last thing‚Ä¶</h2>
      <p id="finalText">I made this just for you. Will you be my Valentine?</p>

      <div class="ringStage">
        <div class="ringGlow" id="ringGlow"></div>
        <div class="ring" id="ring"></div>
      </div>

      <div class="row">
        <button class="yes" id="finalYes">YES üíñ</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">Nice try üòå It remembers.</div>

<script>
  // ======================
  // PERSONALIZE (optional)
  // ======================
  const HER_NAME  = ""; // e.g. "Priya"
  const FROM_NAME = ""; // e.g. "Akash"

  // Optional: add your own MP3 file (e.g., /music/love.mp3) and set this:
  const MUSIC_SRC = ""; // e.g. "music/love.mp3"

  // Built-in ‚Äúno-photo‚Äù slideshow
  const MEMORIES = [
    { tag:"Fact", emoji:"üíñ", text:"I‚Äôm not asking the internet. I‚Äôm asking my favorite person." },
    { tag:"Cute", emoji:"ü•π", text:"If loving you was a job‚Ä¶ I‚Äôd be employee of the year. Every year." },
    { tag:"Truth", emoji:"üòå", text:"The NO button runs because it knows it‚Äôs wrong." },
    { tag:"Deal", emoji:"üçì", text:"Valentine‚Äôs perks include snacks, hugs, and me being extra annoying." },
    { tag:"Plot", emoji:"üé¨", text:"This is the part where you say YES and we both act surprised." },
    { tag:"Final", emoji:"üíç", text:"Okay‚Ä¶ enough teasing. One question. One answer. YES? üíò" },
  ];

  // ======================
  // STATE + ELEMENTS
  // ======================
  const stage = document.getElementById("stage");
  const yesBtn = document.getElementById("yesBtn");
  const noBtn = document.getElementById("noBtn");
  const bubbleText = document.getElementById("bubbleText");
  const counter = document.getElementById("counter");
  const mood = document.getElementById("mood");
  const overlay = document.getElementById("overlay");
  const finalYes = document.getElementById("finalYes");
  const closeOverlay = document.getElementById("closeOverlay");
  const confetti = document.getElementById("confetti");
  const resetLink = document.getElementById("resetLink");
  const title = document.getElementById("title");
  const subtitle = document.getElementById("subtitle");
  const finalTitle = document.getElementById("finalTitle");
  const finalText = document.getElementById("finalText");
  const badgeText = document.getElementById("badgeText");
  const ring = document.getElementById("ring");
  const ringGlow = document.getElementById("ringGlow");
  const toast = document.getElementById("toast");

  // memory cards
  const mA = document.getElementById("mA");
  const mB = document.getElementById("mB");
  const slideMeta = document.getElementById("slideMeta");
  let showingA = true;

  // music UI
  const audioPill = document.getElementById("audioPill");
  const audioIcon = document.getElementById("audioIcon");
  const audioLabel = document.getElementById("audioLabel");
  const audioSmall = document.getElementById("audioSmall");
  let audio = null;
  let musicOn = false;

  // teasing
  const noLabels = [
    "No üôà","Nope üòÖ","Not today üò≥","I‚Äôm shy ü´£","Try again üòå",
    "Absolutely not üòÇ","Maybe‚Ä¶ üëÄ","No (for now) ü§≠","No x2 üòà","No x3 üò≠"
  ];
  const teaseLines = [
    "The NO button has cardio today.",
    "Plot twist: it‚Äôs allergic to being clicked.",
    "Almost caught it‚Ä¶ ALMOST.",
    "It‚Äôs doing parkour. üèÉ‚Äç‚ôÄÔ∏èüí®",
    "It says: ‚Äònot me, not today.‚Äô",
    "It entered stealth mode.",
    "Meanwhile YES is just sitting there‚Ä¶ loyal.",
    "It‚Äôs practicing evasive maneuvers.",
    "Okay okay‚Äîtry YES once. Just to test üòå",
    "I swear YES is the only stable option üòÇ",
  ];
  const moods = ["ü•∫","üòü","üò©","üò≠","ü´†","üò§","üò≥","ü§≠","üòá","üíò"];

  // ‚Äúremembers‚Äù on refresh
  const KEY = "valentine_app_state_v2";
  let state = loadState() ?? { noAttempts: 0, noIndex: 0, memIndex: 0, hasSeenToast: false, done:false };

  function rand(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }

  // ======================
  // MUSIC (user gesture) - reliable
  // ======================
  function setupAudio(){
    if (!MUSIC_SRC) return;
    audio = new Audio(MUSIC_SRC);
    audio.loop = true;
    audio.preload = "auto";
    audio.volume = 0.85;
  }
  
  async function startMusicFromGesture(){
    if (!audio) return;
  
    // iOS Safari sometimes needs a "load" after a gesture
    try { audio.load(); } catch {}
  
    try{
      await audio.play();
      musicOn = true;
      audioPill.classList.remove("off");
      audioIcon.textContent = "üîä";
      audioSmall.textContent = "on";
    }catch(e){
      showToast("Tap once more to allow music üéµ");
    }
  }
  
  function stopMusic(){
    if (!audio) return;
    audio.pause();
    audio.currentTime = 0;
    musicOn = false;
    audioPill.classList.add("off");
    audioIcon.textContent = "üîá";
    audioSmall.textContent = "(tap)";
  }
  
  async function toggleMusic(){
    if (!audio){
      showToast("Add an MP3 + set MUSIC_SRC üòä");
      return;
    }
    if (!musicOn) await startMusicFromGesture();
    else stopMusic();
  }
  
  // Button toggles music
  audioPill.addEventListener("click", toggleMusic);
  audioPill.addEventListener("touchstart", (e)=>{ e.preventDefault(); toggleMusic(); }, {passive:false});
  
  // Bonus: first tap anywhere can start music (super reliable)
  function oneTimeStart(){
    if (!musicOn && audio) startMusicFromGesture();
    document.removeEventListener("click", oneTimeStart);
    document.removeEventListener("touchstart", oneTimeStart);
  }
  document.addEventListener("click", oneTimeStart, {once:true});
  document.addEventListener("touchstart", oneTimeStart, {once:true, passive:false});

  // ======================
  // BUTTONS
  // ======================
  function placeInitialButtons(){
    const rect = stage.getBoundingClientRect();
    const pad = 14;
    yesBtn.style.left = pad + "px";
    yesBtn.style.top  = (rect.height - 86) + "px";
    noBtn.style.left  = (rect.width - 128) + "px";
    noBtn.style.top   = (rect.height - 82) + "px";
  }

  function moveNoButton(){
    const rect = stage.getBoundingClientRect();
    const btnRect = noBtn.getBoundingClientRect();
    const maxX = rect.width - btnRect.width - 14;
    const maxY = rect.height - btnRect.height - 14;
    const x = rand(14, Math.max(14, maxX));
    const y = rand(64, Math.max(64, maxY));
    noBtn.style.left = x + "px";
    noBtn.style.top  = y + "px";
    noBtn.style.transform = `rotate(${rand(-10, 10)}deg)`;
  }

  function growYesButton(){
    const scale = Math.min(1 + state.noAttempts * 0.08, 1.8);
    yesBtn.style.transform = `scale(${scale})`;
    yesBtn.style.filter = `brightness(${1 + Math.min(state.noAttempts*0.03, 0.25)})`;
  }

  function updateTease(){
    const tease = teaseLines[rand(0, teaseLines.length-1)];
    bubbleText.innerHTML = `Will you be my Valentine? <br/><small><b>${tease}</b></small>`;
  }

  function updateUI(){
    counter.textContent = `No attempts: ${state.noAttempts}`;
    mood.textContent = `Mood: ${moods[Math.min(state.noAttempts, moods.length-1)]}`;
    noBtn.textContent = noLabels[state.noIndex % noLabels.length];
    state.noIndex++;
    saveState();
  }

  function onNoTry(){
    if (state.done) return;
    state.noAttempts++;
    if (musicOn && !audio) beep(880, 0.07);

    updateUI();
    updateTease();
    moveNoButton();
    growYesButton();
    nextMemory();

    if (state.noAttempts === 6) {
      title.textContent = "Okay‚Ä¶ dramatic pause üòå";
      subtitle.textContent = "Now the official question (with maximum romance).";
      finalTitle.textContent = HER_NAME ? `${HER_NAME}‚Ä¶` : "Hey you‚Ä¶";
      finalText.innerHTML = `
        I made this just for you. <br/>
        And I have one question:
        <br/><br/>
        <b>Will you be my Valentine?</b>
        ${FROM_NAME ? `<br/><br/>‚Äî ${FROM_NAME} ‚ù§Ô∏è` : ``}
      `;
      openFinal();
    }
    saveState();
  }

  // dodge
  noBtn.addEventListener("mouseenter", onNoTry);
  noBtn.addEventListener("touchstart", (e) => { e.preventDefault(); onNoTry(); }, {passive:false});

  // ======================
  // CONFETTI
  // ======================
  function popConfetti(){
    confetti.innerHTML = "";
    const pieces = 120;
    for(let i=0;i<pieces;i++){
      const p = document.createElement("div");
      p.className = "piece";
      p.style.left = rand(0, 100) + "vw";
      p.style.top = rand(-30, -5) + "vh";
      p.style.background = `hsl(${rand(330, 30)}, ${rand(70,95)}%, ${rand(55,70)}%)`;
      p.style.animationDuration = (Math.random()*0.9 + 1.1) + "s";
      p.style.width = rand(7, 12) + "px";
      p.style.height = rand(9, 16) + "px";
      confetti.appendChild(p);
    }
    setTimeout(()=> confetti.innerHTML="", 2000);
  }

  // ======================
  // OVERLAY + RING
  // ======================
  function openFinal(){
    overlay.style.display = "flex";
    ring.classList.remove("show");
    ringGlow.classList.remove("show");
    requestAnimationFrame(()=>{
      ring.classList.add("show");
      ringGlow.classList.add("show");
    });
    if (musicOn && !audio) beep(660, 0.10);
  }
  function closeFinal(){ overlay.style.display = "none"; }
  closeOverlay.addEventListener("click", closeFinal);

  // ======================
  // YES FLOW
  // ======================
  function yesFlow(){
    state.done = true;
    saveState();

    if (musicOn && !audio) { beep(523,0.09); setTimeout(()=>beep(659,0.09),110); setTimeout(()=>beep(784,0.11),230); }
    popConfetti();

    title.textContent = "YAAAAAY üíñ";
    subtitle.textContent = "You just made my entire universe happier.";

    bubbleText.innerHTML = `
      <b>YES?!</b> üò≠üíò<br/>
      <small>
        You are officially my Valentine.<br/>
        Rewards: kisses, snacks, and unlimited ‚ÄúI love you‚Äùs.
      </small>
    `;

    finalTitle.textContent = "Best. Answer. Ever.";
    finalText.innerHTML = `
      I love you. Thank you for being you. üíû<br/><br/>
      Now come here‚Ä¶ I owe you a celebration.
      ${FROM_NAME ? `<br/><br/>‚Äî ${FROM_NAME} ‚ù§Ô∏è` : ``}
    `;
    openFinal();
  }

  yesBtn.addEventListener("click", yesFlow);
  finalYes.addEventListener("click", () => { closeFinal(); yesFlow(); });

  // ======================
  // RESET
  // ======================
  resetLink.addEventListener("click", (e) => {
    e.preventDefault();
    state = { noAttempts: 0, noIndex: 0, memIndex: 0, hasSeenToast: true, done:false };
    saveState();

    title.textContent = "Hey love‚Ä¶ I have a tiny question üíå";
    subtitle.textContent = "No speeches. Just vibes. And one button that refuses to be clicked.";
    bubbleText.innerHTML = `Will you be my Valentine? <br/><small>(The <b>NO</b> button is‚Ä¶ doing cardio.)</small>`;
    yesBtn.style.transform = "scale(1)";
    yesBtn.style.filter = "none";
    noBtn.textContent = "No üôà";
    noBtn.style.transform = "none";

    placeInitialButtons();
    renderMemory(0, true);
    updateUI();
  });

  // ======================
  // MEMORY SLIDESHOW
  // ======================
  function memoryHTML(m){
    return `
      <div class="memoryTop">
        <span class="pill">‚ú® ${m.tag}</span>
        <span class="emojiBig">${m.emoji}</span>
      </div>
      <div class="memoryText">${m.text}</div>
      <div class="memoryFooter">
        <span>Auto-scrolling</span>
        <span>Made for you</span>
      </div>
    `;
  }

  function renderMemory(i, instant=false){
    const idx = (i + MEMORIES.length) % MEMORIES.length;
    state.memIndex = idx;
    slideMeta.textContent = `${idx + 1} / ${MEMORIES.length}`;

    const showEl = showingA ? mA : mB;
    const hideEl = showingA ? mB : mA;

    showEl.innerHTML = memoryHTML(MEMORIES[idx]);
    hideEl.classList.remove("show");

    if (instant){
      showEl.style.transition = "none";
      showEl.classList.add("show");
      requestAnimationFrame(()=> showEl.style.transition = "");
    } else {
      requestAnimationFrame(()=> showEl.classList.add("show"));
    }

    showingA = !showingA;
    saveState();
  }

  function nextMemory(){
    renderMemory(state.memIndex + 1);
  }

  function startMemoryAuto(){
    renderMemory(state.memIndex, true);
    setInterval(()=> {
      if (!state.done) nextMemory();
    }, 4200);
  }

  // ======================
  // ‚ÄúREMEMBERS‚Äù EASTER EGG
  // ======================
  function loadState(){
    try{
      const raw = localStorage.getItem(KEY);
      if (!raw) return null;
      return JSON.parse(raw);
    }catch{ return null; }
  }
  function saveState(){
    try{ localStorage.setItem(KEY, JSON.stringify(state)); }catch{}
  }
  function showToast(msg){
    toast.textContent = msg;
    toast.classList.add("show");
    setTimeout(()=> toast.classList.remove("show"), 1600);
  }
  (function easterEgg(){
    const nav = performance.getEntriesByType?.("navigation")?.[0];
    const refreshed = nav && nav.type === "reload";
    if (refreshed && !state.hasSeenToast){
      showToast("Nice try üòå It remembers.");
      state.hasSeenToast = true;
      saveState();
    }
  })();

  // ======================
  // INIT
  // ======================
  window.addEventListener("resize", placeInitialButtons);
  placeInitialButtons();
  updateUI();
  setupAudio();
  startMemoryAuto();

  if (HER_NAME) badgeText.textContent = `Valentine Mode: ON for ${HER_NAME} üíò`;

  // If already completed previously, show end state
  if (state.done){
    title.textContent = "YAAAAAY üíñ";
    subtitle.textContent = "Already secured the YES üòå";
    bubbleText.innerHTML = `<b>YES forever.</b> üíû<br/><small>Happy Valentine‚Äôs!</small>`;
  }

</script>

<script>
  // PWA service worker
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./sw.js').catch(()=>{});
    });
  }
</script>

</body>
</html>
